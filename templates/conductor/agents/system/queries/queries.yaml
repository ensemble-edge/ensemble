name: queries
version: 1.0.0
description: |
  Execute SQL queries across Hyperdrive-connected databases.

  Features:
  - Support for named queries from catalog (coming soon)
  - Inline SQL queries with parameter binding
  - Named and positional parameters
  - Column name transformation (camelCase/snake_case)
  - Read-only mode for safety
  - Configurable row limits and timeouts

operation: code
handler: ./queries.ts

tags:
  - queries
  - sql
  - database
  - hyperdrive
  - d1

schema:
  input:
    type: object
    properties:
      queryName:
        type: string
        description: Query name from catalog (mutually exclusive with sql)
      sql:
        type: string
        description: Inline SQL query (mutually exclusive with queryName)
      input:
        description: Query parameters (named object or positional array)
      database:
        type: string
        description: Database alias (overrides default)

  output:
    type: object
    properties:
      rows:
        type: array
        description: Query results
      count:
        type: integer
        description: Number of rows returned
      metadata:
        type: object
        properties:
          columns:
            type: array
            items:
              type: string
          executionTime:
            type: number
            description: Execution time in ms
          cached:
            type: boolean
          database:
            type: string
          query:
            type: string
            description: Executed query (if includeMetadata)

config:
  schema:
    type: object
    properties:
      defaultDatabase:
        type: string
        description: Default database binding name
      cacheTTL:
        type: integer
        description: Cache TTL for query results (seconds)
      maxRows:
        type: integer
        description: Maximum rows to return
      timeout:
        type: integer
        description: Query timeout (ms)
      readOnly:
        type: boolean
        default: false
        description: Prevent write operations
      transform:
        type: string
        enum: [none, camelCase, snakeCase]
        default: none
        description: Transform column names
      includeMetadata:
        type: boolean
        default: true
        description: Include metadata in output

examples:
  - name: simple-select
    description: Simple SELECT query
    input:
      sql: "SELECT * FROM users WHERE active = ?"
      input: [true]
      database: "DB"
    config:
      defaultDatabase: DB
    output:
      rows:
        - id: 1
          name: "John Doe"
          active: true
        - id: 2
          name: "Jane Smith"
          active: true
      count: 2
      metadata:
        columns: [id, name, active]
        executionTime: 15
        cached: false
        database: "DB"

  - name: named-params
    description: Query with named parameters
    input:
      sql: "SELECT * FROM products WHERE category = :category AND price < :maxPrice"
      input:
        category: "electronics"
        maxPrice: 500
    config:
      defaultDatabase: DB
      transform: camelCase
    output:
      rows:
        - id: 1
          productName: "Smartphone"
          categoryName: "electronics"
          priceUsd: 299
      count: 1
