name: scrape
version: 1.0.0
description: |
  3-tier web scraping with bot protection detection and fallback strategies.

  Tier 1: Fast browser rendering (domcontentloaded) - ~350ms
  Tier 2: Slow browser rendering (networkidle2) - ~2s
  Tier 3: HTML parsing fallback - ~1.5s

  Features:
  - Automatic fallback on bot protection detection
  - Multiple return formats (markdown, html, text)
  - Configurable strategy (fast, balanced, aggressive)

operation: code
handler: ./scrape.ts

tags:
  - scrape
  - fetch
  - browser
  - html

schema:
  input:
    type: object
    required: [url]
    properties:
      url:
        type: string
        format: uri
        description: URL to scrape

  output:
    type: object
    properties:
      success:
        type: boolean
      url:
        type: string
      markdown:
        type: string
        description: Content converted to markdown
      html:
        type: string
        description: Raw HTML content
      text:
        type: string
        description: Plain text extraction
      title:
        type: string
        description: Page title
      tier:
        type: integer
        enum: [1, 2, 3]
        description: Which tier successfully scraped
      duration:
        type: number
        description: Total scrape time in ms
      botProtectionDetected:
        type: boolean
      contentLength:
        type: integer

config:
  schema:
    type: object
    properties:
      strategy:
        type: string
        enum: [fast, balanced, aggressive]
        default: balanced
        description: |
          fast: Only Tier 1, return fallback on failure
          balanced: Tier 1 + Tier 2, then fallback
          aggressive: All 3 tiers
      returnFormat:
        type: string
        enum: [markdown, html, text]
        default: markdown
        description: Format for the returned content
      blockResources:
        type: boolean
        default: true
        description: Block images, fonts, etc. for faster scraping
      userAgent:
        type: string
        description: Custom user agent string
      timeout:
        type: integer
        default: 30000
        description: Request timeout in milliseconds

examples:
  - name: scrape-markdown
    description: Scrape a URL and get markdown content
    input:
      url: "https://example.com"
    config:
      strategy: balanced
      returnFormat: markdown
    output:
      success: true
      url: "https://example.com"
      markdown: "# Example Domain\n\nThis domain is for..."
      title: "Example Domain"
      tier: 1
      duration: 350
      botProtectionDetected: false
      contentLength: 1256

  - name: scrape-fast
    description: Quick scrape with fast strategy
    input:
      url: "https://example.com"
    config:
      strategy: fast
      returnFormat: text
    output:
      success: true
      text: "Example Domain. This domain is for..."
      tier: 1
      duration: 280
