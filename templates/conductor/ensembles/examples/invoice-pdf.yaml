name: invoice-pdf
description: Generate invoice PDF with display/download options

agents:
  - name: generate-invoice
    operation: pdf
    config:
      html:
        inline: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body {
                font-family: Arial, sans-serif;
                margin: 40px;
              }
              .header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 40px;
              }
              .company {
                font-size: 24px;
                font-weight: bold;
                color: #2D1B69;
              }
              .invoice-title {
                font-size: 32px;
                color: #2D1B69;
                margin-bottom: 20px;
              }
              .invoice-details {
                margin-bottom: 30px;
              }
              .invoice-details table {
                width: 100%;
                border-collapse: collapse;
              }
              .invoice-details td {
                padding: 5px 0;
              }
              .items-table {
                width: 100%;
                border-collapse: collapse;
                margin: 30px 0;
              }
              .items-table th {
                background: #2D1B69;
                color: white;
                padding: 12px;
                text-align: left;
              }
              .items-table td {
                padding: 12px;
                border-bottom: 1px solid #ddd;
              }
              .totals {
                text-align: right;
                margin-top: 20px;
              }
              .totals table {
                margin-left: auto;
                width: 300px;
              }
              .totals td {
                padding: 8px;
              }
              .total-amount {
                font-size: 20px;
                font-weight: bold;
                color: #2D1B69;
                border-top: 2px solid #2D1B69;
              }
              .footer {
                margin-top: 50px;
                text-align: center;
                color: #666;
                font-size: 12px;
              }
            </style>
          </head>
          <body>
            <div class="header">
              <div>
                <div class="company">{{companyName}}</div>
                <div>{{companyAddress}}</div>
                <div>{{companyPhone}}</div>
                <div>{{companyEmail}}</div>
              </div>
              <div>
                <div class="invoice-title">INVOICE</div>
                <div><strong>Invoice #:</strong> {{invoiceNumber}}</div>
                <div><strong>Date:</strong> {{invoiceDate}}</div>
                <div><strong>Due Date:</strong> {{dueDate}}</div>
              </div>
            </div>

            <div class="invoice-details">
              <h3>Bill To:</h3>
              <table>
                <tr>
                  <td><strong>{{customerName}}</strong></td>
                </tr>
                <tr>
                  <td>{{customerAddress}}</td>
                </tr>
                <tr>
                  <td>{{customerEmail}}</td>
                </tr>
              </table>
            </div>

            <table class="items-table">
              <thead>
                <tr>
                  <th>Description</th>
                  <th style="text-align: center;">Quantity</th>
                  <th style="text-align: right;">Unit Price</th>
                  <th style="text-align: right;">Amount</th>
                </tr>
              </thead>
              <tbody>
                {{#each items}}
                <tr>
                  <td>{{description}}</td>
                  <td style="text-align: center;">{{quantity}}</td>
                  <td style="text-align: right;">${{unitPrice}}</td>
                  <td style="text-align: right;">${{amount}}</td>
                </tr>
                {{/each}}
              </tbody>
            </table>

            <div class="totals">
              <table>
                <tr>
                  <td>Subtotal:</td>
                  <td style="text-align: right;">${{subtotal}}</td>
                </tr>
                <tr>
                  <td>Tax ({{taxRate}}%):</td>
                  <td style="text-align: right;">${{taxAmount}}</td>
                </tr>
                <tr class="total-amount">
                  <td>Total:</td>
                  <td style="text-align: right;">${{total}}</td>
                </tr>
              </table>
            </div>

            <div class="footer">
              <p>Thank you for your business!</p>
              <p>Payment is due by {{dueDate}}</p>
            </div>
          </body>
          </html>
      page:
        size: A4
        orientation: portrait
        margins:
          top: 20
          right: 20
          bottom: 20
          left: 20
      storage:
        saveToR2: true
        r2Key: static/invoices/invoice-{{invoiceNumber}}.pdf
        publicUrl: true
      deliveryMode: ${input.deliveryMode}
      filename: invoice-{{invoiceNumber}}.pdf
      metadata:
        title: "Invoice {{invoiceNumber}}"
        author: "{{companyName}}"
        subject: "Invoice for {{customerName}}"

flow:
  - agent: generate-invoice
    input:
      html:
        data:
          companyName: ${input.companyName}
          companyAddress: ${input.companyAddress}
          companyPhone: ${input.companyPhone}
          companyEmail: ${input.companyEmail}
          invoiceNumber: ${input.invoiceNumber}
          invoiceDate: ${input.invoiceDate}
          dueDate: ${input.dueDate}
          customerName: ${input.customerName}
          customerAddress: ${input.customerAddress}
          customerEmail: ${input.customerEmail}
          items: ${input.items}
          subtotal: ${input.subtotal}
          taxRate: ${input.taxRate}
          taxAmount: ${input.taxAmount}
          total: ${input.total}
      deliveryMode: ${input.deliveryMode}
