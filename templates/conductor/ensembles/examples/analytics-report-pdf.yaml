name: analytics-report-pdf
description: Generate analytics report PDF from HTML agent

agents:
  - name: render-report-html
    operation: html
    config:
      template:
        inline: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              @page {
                margin: 20mm;
              }
              body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
              }
              .cover {
                text-align: center;
                margin-top: 100px;
              }
              .cover h1 {
                font-size: 48px;
                color: #2D1B69;
                margin-bottom: 20px;
              }
              .cover .subtitle {
                font-size: 24px;
                color: #666;
                margin-bottom: 50px;
              }
              .cover .date {
                font-size: 18px;
                color: #999;
              }
              .section {
                page-break-before: always;
                margin-top: 40px;
              }
              .section h2 {
                color: #2D1B69;
                border-bottom: 2px solid #4FD1C5;
                padding-bottom: 10px;
              }
              .metric-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                margin: 30px 0;
              }
              .metric-card {
                background: #f5f7fa;
                padding: 20px;
                border-radius: 8px;
                border-left: 4px solid #4FD1C5;
              }
              .metric-label {
                font-size: 14px;
                color: #666;
                text-transform: uppercase;
                letter-spacing: 1px;
              }
              .metric-value {
                font-size: 32px;
                font-weight: bold;
                color: #2D1B69;
                margin: 10px 0;
              }
              .metric-change {
                font-size: 14px;
              }
              .metric-change.positive {
                color: #48bb78;
              }
              .metric-change.negative {
                color: #f56565;
              }
              table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
              }
              th {
                background: #2D1B69;
                color: white;
                padding: 12px;
                text-align: left;
              }
              td {
                padding: 12px;
                border-bottom: 1px solid #ddd;
              }
              tr:hover {
                background: #f5f7fa;
              }
            </style>
          </head>
          <body>
            <!-- Cover Page -->
            <div class="cover">
              <h1>{{title}}</h1>
              <div class="subtitle">{{subtitle}}</div>
              <div class="date">Generated on {{reportDate}}</div>
            </div>

            <!-- Executive Summary -->
            <div class="section">
              <h2>Executive Summary</h2>
              <p>{{summary}}</p>

              <div class="metric-grid">
                {{#each metrics}}
                <div class="metric-card">
                  <div class="metric-label">{{label}}</div>
                  <div class="metric-value">{{value}}</div>
                  <div class="metric-change {{changeClass}}">
                    {{change}}
                  </div>
                </div>
                {{/each}}
              </div>
            </div>

            <!-- Detailed Data -->
            <div class="section">
              <h2>Detailed Analytics</h2>
              <table>
                <thead>
                  <tr>
                    <th>Metric</th>
                    <th>Current</th>
                    <th>Previous</th>
                    <th>Change</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each detailedData}}
                  <tr>
                    <td>{{metric}}</td>
                    <td>{{current}}</td>
                    <td>{{previous}}</td>
                    <td class="{{changeClass}}">{{change}}</td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>

            <!-- Recommendations -->
            <div class="section">
              <h2>Recommendations</h2>
              <ul>
                {{#each recommendations}}
                <li>{{this}}</li>
                {{/each}}
              </ul>
            </div>
          </body>
          </html>

  - name: convert-to-pdf
    operation: pdf
    config:
      html:
        fromMember: render-report-html
      page:
        size: A4
        orientation: portrait
        printBackground: true
      headerFooter:
        displayHeaderFooter: true
        header: |
          <div style="font-size: 10px; text-align: center; width: 100%; margin: 0 10mm;">
            <span>{{title}} - Confidential</span>
          </div>
        footer: |
          <div style="font-size: 10px; text-align: center; width: 100%; margin: 0 10mm;">
            <span class="pageNumber"></span> / <span class="totalPages"></span>
          </div>
      storage:
        saveToR2: true
        r2Key: static/reports/analytics-{{timestamp}}.pdf
        publicUrl: true
      deliveryMode: attachment
      filename: analytics-report-{{reportDate}}.pdf
      metadata:
        title: "{{title}}"
        author: "{{companyName}}"
        subject: Analytics Report

flow:
  - agent: render-report-html
    input:
      data:
        title: ${input.title}
        subtitle: ${input.subtitle}
        reportDate: ${input.reportDate}
        summary: ${input.summary}
        metrics: ${input.metrics}
        detailedData: ${input.detailedData}
        recommendations: ${input.recommendations}

  - agent: convert-to-pdf
    input:
      storage:
        r2Key: static/reports/analytics-${input.timestamp}.pdf
      filename: analytics-report-${input.reportDate}.pdf
      metadata:
        title: ${input.title}
        author: ${input.companyName}
