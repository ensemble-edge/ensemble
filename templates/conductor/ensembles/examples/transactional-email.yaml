name: transactional-email
description: |
  Advanced transactional email workflow with error handling and fallback.
  Demonstrates:
  - Try/catch error handling
  - Email with inline HTML (no template)
  - Multiple providers with fallback
  - Conditional logic based on email result

agents:
  - name: send-primary
    operation: email
    config:
      provider:
        provider: cloudflare
        from: transactional@example.com

  - name: send-fallback
    operation: email
    config:
      provider:
        provider: smtp
        smtp:
          host: smtp.backup.com
          port: 587
          secure: true
          auth:
            user: ${env.SMTP_USER}
            pass: ${env.SMTP_PASS}
        from: transactional@example.com

flow:
  # Try primary email provider
  - type: try
    steps:
      - agent: send-primary
        input:
          to: ${input.email}
          subject: ${input.subject}
          html: |
            <html>
              <body style="font-family: Arial, sans-serif;">
                <h1>Order Confirmation</h1>
                <p>Thank you for your order, ${input.customerName}!</p>
                <p><strong>Order ID:</strong> ${input.orderId}</p>
                <p><strong>Total:</strong> $${input.total}</p>
                <p>We'll send you a shipping notification when your order is on its way.</p>
              </body>
            </html>
          tags:
            - transactional
            - order-confirmation
          metadata:
            orderId: ${input.orderId}
            customerId: ${input.customerId}

    # Fallback to SMTP if Cloudflare fails
    catch:
      - agent: send-fallback
        input:
          to: ${input.email}
          subject: ${input.subject}
          html: |
            <html>
              <body style="font-family: Arial, sans-serif;">
                <h1>Order Confirmation</h1>
                <p>Thank you for your order, ${input.customerName}!</p>
                <p><strong>Order ID:</strong> ${input.orderId}</p>
                <p><strong>Total:</strong> $${input.total}</p>
                <p>We'll send you a shipping notification when your order is on its way.</p>
              </body>
            </html>

output:
  success: true
  messageId: "${send-primary.output.messageId || send-fallback.output.messageId}"
  provider: "${send-primary.output.provider || send-fallback.output.provider}"
  timestamp: "${send-primary.output.timestamp || send-fallback.output.timestamp}"
  usedFallback: "${send-fallback.output ? true : false}"
